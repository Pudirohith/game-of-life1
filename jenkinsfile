pipeline {
   agent any
    environment {

      sonar_url = 'http://172.31.40.170:9000/'
      sonar_username = 'admin'
      sonar_password = 'admin'
 }
    tools {
      // Install the Maven version configured as "M3" and add it to the path.
	  jdk 'java8'
      maven "Maven3.3.9"
   }
   
   stages
   {
   stage('git clone') {
         steps {
            // Get some code from a GitHub repository
            git 'https://github.com/Pudirohith/game-of-life1.git'
        }  
      }
	stage ('Compile and Build') {
         steps {
           sh 'mvn clean install -U  -Dmaven.test.skip=true'
         }
	}
  stage ('Sonarqube Analysis'){
           steps {
           withSonarQubeEnv(sonarqube){
	 sh 'mvn -e -B sonar:sonar -Dsonar.java.source=1.8 -Dsonar.host.url="172.31.40.170:9000" -Dsonar.login="admin" -Dsonar.password="admin" -Dsonar.sourceEncoding=UTF-8'
    // some block
         }
         }
      }
      stage ('Publishing Artifact') {
	steps {
	nexusPublisher nexusInstanceId: '3.11.20210811-095455.fdf8fec', nexusRepositoryId: 'maven-jar', packages: [[$class: 'MavenPackage', mavenAssetList: [[classifier: '', extension: '', filePath: '/var/lib/jenkins/workspace/pipeline-job/gameoflife-build/target/gameoflife-build-1.0-SNAPSHOT.jar']], mavenCoordinate: [artifactId: 'gameoflife1', groupId: 'com.wakaleo.gameoflife', packaging: 'pom', version: '4.0.0']]]
	}
     }
  }
}
